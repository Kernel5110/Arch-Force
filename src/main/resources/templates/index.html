<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Document Editor - Home</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- Replace header -->
    <div th:replace="~{fragments/header :: header}"></div>

    <main class="container">
        <h1><i class="fas fa-file-alt"></i> Collaborative Document Editor</h1>

        <div class="form-group">
            <h3>Create New Document</h3>
            <form id="createForm" onsubmit="createDocument(event)">
                <input type="text" id="title" placeholder="Document Title" required>
                <input type="text" id="author" placeholder="Author Name" required>
                <button type="submit" class="btn"><i class="fas fa-plus"></i> Create</button>
            </form>
        </div>

        <h3>Existing Documents</h3>
        <table id="docTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="doc : ${documents}">
                    <td th:text="${doc.id}">ID</td>
                    <td th:text="${doc.title}">Title</td>
                    <td th:text="${doc.author}">Author</td>
                    <td>
                        <a th:href="@{'/editor/' + ${doc.id}}" class="btn btn-secondary">
                            <i class="fas fa-edit"></i> Open
                        </a>
                    </td>
                </tr>
                <tr th:if="${documents.empty}">
                    <td colspan="4" style="text-align:center">No documents found. Create one!</td>
                </tr>
            </tbody>
        </table>
    </main>

    <!-- Replace footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        async function createDocument(e) {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value;

            try {
                const response = await fetch('/api/documents/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, author, metadata: "" })
                });

                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Error creating document');
                }
            } catch (error) {
                console.error(error);
                alert('Error creating document');
            }
        }
    </script>
</body>

</html>